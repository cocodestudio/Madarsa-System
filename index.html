<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Madarsa System - Login</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Three.js for 3D Background -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
      /* Custom Colors */
      :root {
        --color-primary: #00a693;
        --color-background: #f2f3f4;
        --color-accent: #e08a27;
        --color-text-dark: #1a1a1a;
        --color-text-light: #ffffff;
      }

      /* Local Urdu Font - NOTE: Using web-safe Nastaliq is recommended for better compatibility */
      @font-face {
        font-family: "UrduLocal";
        /* This local path will only work if the file is truly accessible by the browser environment */
        src: url("assets/urdu.ttf") format("truetype");
        font-weight: 400;
        font-style: normal;
      }

      /* Google Fonts (Poppins + Hindi only) */
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Noto+Sans+Devanagari:wght@400;700&family=Noto+Nastaliq+Urdu:wght@400;700&display=swap");

      body {
        font-family: "Poppins", sans-serif;
        color: var(--color-text-dark);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        position: relative;
        background: #111;
        /* overflow: hidden; */
      }

      /* Full-screen 3D Canvas */
      #three-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: block;
        z-index: -1;
        background-color: #0b151f;
      }

      /* Language Styles */
      .lang-en,
      .lang-hi {
        direction: ltr;
      }

      .lang-en {
        font-family: "Poppins", sans-serif;
      }

      .lang-hi {
        font-family: "Noto Sans Devanagari", sans-serif;
      }

      .lang-ur {
        /* Fallback to web-safe Nastaliq if local font fails */
        font-family: "UrduLocal", "Noto Nastaliq Urdu", "Segoe UI", Tahoma,
          Geneva, Verdana, sans-serif !important;
        direction: rtl;
        line-height: 1.8;
        text-align: right;
      }

      /* Login Box */
      .login-wrapper {
        background-color: var(--color-text-light);
        border-radius: 1.5rem;
        box-shadow: 0 15px 45px rgba(0, 0, 0, 0.5);
        border: none;
        overflow: hidden;
        width: 95%;
        max-width: 900px;
        display: flex;
        min-height: 500px;
        animation: fadeIn 0.8s ease-out;
        z-index: 10;
        margin-top: 5rem;
        margin-bottom: 2rem;
      }

      .login-marketing-area {
        flex: 1;
        background: linear-gradient(135deg, var(--color-primary), #00665b);
        color: var(--color-text-light);
        padding: 3rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
      }

      .login-form-area {
        flex: 1;
        padding: 3rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      @media (max-width: 768px) {
        .login-wrapper {
          flex-direction: column;
          max-width: 420px;
          margin-top: 5rem;
        }

        .login-marketing-area {
          display: none;
        }

        .login-form-area {
          width: 100%;
          padding: 2rem;
        }
      }

      .lang-ur .login-wrapper {
        flex-direction: row-reverse;
      }

      /* Form Elements */
      .form-input {
        width: 100%;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        border: 1px solid #ccc;
        margin-top: 0.5rem;
        transition: border-color 0.3s, box-shadow 0.3s;
        font-family: inherit;
      }

      .form-input:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px rgba(0, 166, 147, 0.2);
      }

      .primary-button {
        width: 100%;
        padding: 0.8rem 1.5rem;
        background-color: var(--color-primary);
        color: var(--color-text-light);
        font-weight: 600;
        border-radius: 0.75rem;
        transition: background-color 0.3s, transform 0.1s;
        box-shadow: 0 4px 10px rgba(0, 166, 147, 0.4);
        cursor: pointer;
      }

      .primary-button:hover {
        background-color: #008f7d;
        transform: translateY(-1px);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }

        to {
          opacity: 1;
        }
      }

      .dialog-backdrop {
        background-color: rgba(0, 0, 0, 0.7);
        transition: opacity 0.3s ease;
      }

      .dialog-content {
        background-color: var(--color-background);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        border: 3px solid var(--color-primary);
        transition: transform 0.3s ease, opacity 0.3s ease;
      }

      .lang-ur .form-label {
        text-align: right;
        display: block;
      }

      .lang-ur .login-marketing-area {
        text-align: right;
      }

      /* --- Custom Loader Styles --- */
      #login-loader {
        display: none;
        /* Initially hidden */
        margin-top: 1rem;
        justify-content: center;
        align-items: center;
        height: 2.5rem;
        /* Match button height */
      }

      .loader-spinner {
        width: 20px;
        height: 20px;
        border: 3px solid rgba(0, 166, 147, 0.3);
        /* Lighter border for background */
        border-top-color: var(--color-primary);
        /* Primary color for spinning part */
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body class="lang-en">
    <!-- Language Data Structure -->
    <script>
      const langData = {
        en: {
          login_title: "Welcome Back",
          login_subtitle: "Sign in to access the Madarsa Management System.",
          email_id: "Email",
          password: "Password",
          forgot_password: "Forgot Password?",
          login_button: "Log In",
          or: "OR",
          new_user: "New User? Contact Administration",
          select_language: "Select Language",
          en_option: "English",
          hi_option: "हिन्दी (Hindi)",
          ur_option: "اردو (Urdu)",
          system_name: "Madarsa System",
          marketing_title: "Excellence in Islamic Education Management",
          marketing_text:
            "Our integrated digital solution empowers Madrasa administration, ensuring streamlined academic, financial, and hostel management with secure, modern technology.",
          marketing_quote: '"Verily, with hardship comes ease."',
          marketing_source: "Al-Inshirah (94:6)",
          loading: "Logging in...",
        },
        hi: {
          login_title: "आपका स्वागत है",
          login_subtitle:
            "मदरसा प्रबंधन प्रणाली तक पहुंचने के लिए साइन इन करें।",
          email_id: "ईमेल आईडी",
          password: "पासवर्ड",
          forgot_password: "पासवर्ड भूल गए?",
          login_button: "लॉग इन करें",
          or: "या",
          new_user: "नए उपयोगकर्ता? प्रशासन से संपर्क करें",
          select_language: "भाषा चुनें",
          en_option: "English",
          hi_option: "हिन्दी (Hindi)",
          ur_option: "اردو (Urdu)",
          system_name: "मदरसा प्रणाली",
          marketing_title: "इस्लामी शिक्षा प्रबंधन में उत्कृष्टता",
          marketing_text:
            "हमारा एकीकृत डिजिटल समाधान मदरसा प्रशासन को सशक्त बनाता है।",
          marketing_quote: '"निस्संदेह, कठिनाई के साथ आसानी है।"',
          marketing_source: "अल-इंशिरह (94:6)",
          loading: "लॉग इन हो रहा है...",
        },
        ur: {
          login_title: "خوش آمدید",
          login_subtitle: "مدرسہ انتظامی نظام تک رسائی کے لیے سائن ان کریں۔",
          email_id: "ای میل آئی ڈی",
          password: "پاس ورڈ",
          forgot_password: "پاس ورڈ بھول گئے؟",
          login_button: "لاگ اِن کریں",
          or: "یا",
          new_user: "نئے صارف؟ انتظامیہ سے رابطہ کریں",
          select_language: "زبان منتخب کریں",
          en_option: "English",
          hi_option: "ہندی (Hindi)",
          ur_option: "اردو (Urdu)",
          system_name: "مدرسہ نظام",
          marketing_title: "اسلامی تعلیم کے انتظام میں فضیلت",
          marketing_text:
            "ہمارا مربوط ڈیجیٹل حل مدرسہ انتظامیہ کو بااختیار بناتا ہے۔",
          marketing_quote: '"یقیناً، مشکل کے ساتھ آسانی ہے۔"',
          marketing_source: "الانشراح (94:6)",
          loading: "لاگ اِن ہو رہا ہے...",
        },
      };

      let currentLang = "en";
      let dialogContentElement;

      function getTranslation(key) {
        return langData[currentLang][key] || key;
      }

      function updateContent() {
        document.body.className = "lang-" + currentLang + " p-4 md:p-8";
        document.querySelectorAll("[data-lang-key]").forEach((el) => {
          el.textContent = getTranslation(el.dataset.langKey);
        });
        document.getElementById("user-id-input").placeholder =
          getTranslation("email_id");
        document.getElementById("password-input").placeholder =
          getTranslation("password");
        document.getElementById("loader-text").textContent =
          getTranslation("loading");
      }

      function setLoginState(isLoading) {
        document
          .getElementById("login-button-container")
          .classList.toggle("hidden", isLoading);
        document.getElementById("login-loader").style.display = isLoading
          ? "flex"
          : "none";
        document.getElementById("login-btn").disabled = isLoading;
      }

      /* ✅ FINAL LOGIN HANDLER */
      function handleLogin(e) {
        e.preventDefault();

        const email = document.getElementById("user-id-input").value.trim();
        const password = document.getElementById("password-input").value;

        if (!email || !password) {
          alert("Email and password required");
          return;
        }

        setLoginState(true);

        fetch(
          "https://www.sgemplusglobal.com/Madarsa-Management-Software/web-apis/auth/login.php",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password }),
          }
        )
          .then((res) => res.json())
          .then((data) => {
            console.log(data);
            if (data.status === true) {
              localStorage.setItem("isUserLoggedIn", "true");
              localStorage.setItem("authToken", data.token);
              localStorage.setItem("userData", JSON.stringify(data.user));
              window.location.href = "home.html";
            } else {
              setLoginState(false);
              alert(data.message || "Login failed");
            }
          })
          .catch(() => {
            setLoginState(false);
            alert("Server error. Please try again.");
          });
      }

      window.onload = function () {
        if (localStorage.getItem("isUserLoggedIn") === "true") {
          window.location.href = "home.html";
          return;
        }

        dialogContentElement = document.getElementById("dialog-content");
        currentLang = localStorage.getItem("madarsaSystemLang") || "en";

        document
          .getElementById("login-form")
          .addEventListener("submit", handleLogin);
        updateContent();
      };
    </script>

    <!-- HEADER/LANGUAGE SELECTOR ICON -->
    <header
      class="w-full max-w-7xl flex justify-end items-center py-4 absolute top-0 right-0 left-0 mx-auto px-4 md:px-8 z-20"
    >
      <!-- Language Change Icon -->
      <button
        id="language-toggle"
        class="p-2 rounded-full hover:bg-white transition-all flex-shrink-0"
        aria-label="Change Language"
      >
        <!-- Language Icon: Globe (Inline SVG) -->
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="w-6 h-6"
          style="color: var(--color-primary)"
        >
          <circle cx="12" cy="12" r="10" />
          <path
            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"
          />
          <path d="M2.5 7h19M2.5 17h19" />
        </svg>
      </button>
    </header>

    <!-- LOGIN WRAPPER (Horizontal Split on Desktop) -->
    <div class="login-wrapper">
      <!-- LEFT SIDE: Marketing/Decorative Content (Hidden on mobile) -->
      <div class="login-marketing-area">
        <div class="space-y-6 max-w-sm">
          <!-- Large Logo Icon -->
          <div class="w-16 h-16 mx-auto" style="color: var(--color-text-light)">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="w-full h-full"
            >
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
              <path
                d="M6.5 2H20v20h-13.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"
              />
              <path d="M10 8h6" />
              <path d="M10 12h6" />
            </svg>
          </div>
          <h2 data-lang-key="marketing_title" class="text-3xl font-bold">
            Excellence in Islamic Education Management
          </h2>
          <p
            data-lang-key="marketing_text"
            class="text-sm font-light leading-relaxed opacity-90"
          >
            Our integrated digital solution empowers Madrasa administration,
            ensuring streamlined academic, financial, and hostel management with
            secure, modern technology.
          </p>

          <!-- Inspirational Quote -->
          <div class="mt-8 pt-4 border-t border-white border-opacity-30">
            <p
              data-lang-key="marketing_quote"
              class="text-lg italic font-semibold"
            >
              "Verily, with hardship comes ease."
            </p>
            <p data-lang-key="marketing_source" class="text-sm opacity-70 mt-1">
              Al-Inshirah (94:6)
            </p>
          </div>
        </div>
      </div>

      <!-- RIGHT SIDE: Login Form -->
      <div class="login-form-area">
        <!-- Title -->
        <div
          class="flex flex-col items-center sm:items-start mb-8 text-center sm:text-left"
        >
          <h1 data-lang-key="login_title" class="text-3xl font-bold mb-1">
            Welcome Back
          </h1>
          <p data-lang-key="login_subtitle" class="text-gray-500 text-sm">
            Sign in to access the Madarsa Management System.
          </p>
        </div>

        <!-- Login Form -->
        <form id="login-form">
          <div class="space-y-5">
            <!-- User ID Field -->
            <div class="form-group">
              <label
                for="user-id-input"
                class="form-label text-sm font-semibold mb-1"
                data-lang-key="email_id"
                >Email</label
              >
              <input
                type="text"
                id="user-id-input"
                class="form-input"
                required
                placeholder="Email"
              />
            </div>

            <!-- Password Field -->
            <div class="form-group">
              <label
                for="password-input"
                class="form-label text-sm font-semibold mb-1"
                data-lang-key="password"
                >Password</label
              >
              <input
                type="password"
                id="password-input"
                class="form-input"
                required
                placeholder="Password"
              />
            </div>
          </div>

          <!-- Forgot Password Link -->
          <div class="mt-4 text-right lang-ur:text-left">
            <a
              href="forgot_password.html"
              class="text-sm font-medium hover:underline"
              style="color: var(--color-accent)"
              data-lang-key="forgot_password"
              >Forgot Password?</a
            >
          </div>

          <!-- Login Button Container -->
          <div id="login-button-container" class="mt-8">
            <button
              type="submit"
              id="login-btn"
              class="primary-button"
              data-lang-key="login_button"
            >
              Log In
            </button>
          </div>

          <!-- NEW: Loader -->
          <div
            id="login-loader"
            class="mt-8 flex flex-row items-center justify-center space-x-3 bg-gray-100 rounded-xl px-4 py-2 opacity-90"
          >
            <div class="loader-spinner"></div>
            <span
              id="loader-text"
              class="text-sm font-medium"
              style="color: var(--color-text-dark)"
              >Logging in...</span
            >
          </div>
        </form>

        <!-- Separator -->
        <div class="flex items-center my-6">
          <hr class="flex-grow border-gray-300" />
          <span
            class="px-3 text-gray-500 text-sm font-medium"
            data-lang-key="or"
            >OR</span
          >
          <hr class="flex-grow border-gray-300" />
        </div>

        <!-- Contact Admin Link -->
        <div class="text-center">
          <a
            href="contact.html"
            class="text-sm font-medium hover:underline"
            style="color: var(--color-text-dark)"
            data-lang-key="new_user"
            >New User? Contact Administration</a
          >
        </div>
      </div>
    </div>

    <!-- LANGUAGE CHANGE DIALOG -->
    <div
      id="language-dialog"
      class="hidden opacity-0 fixed inset-0 z-50 flex items-center justify-center dialog-backdrop"
    >
      <div
        id="dialog-content"
        class="dialog-content p-6 rounded-xl w-11/12 max-w-sm transform scale-95"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 data-lang-key="select_language" class="text-lg font-bold">
            Select Language
          </h3>
          <button
            id="dialog-close-btn"
            class="text-gray-500 hover:text-gray-900 transition-colors p-1"
            aria-label="Close"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
              class="w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>

        <p class="mb-4 text-sm font-medium">
          Current Language:
          <span
            id="current-lang-display"
            class="font-bold text-primary"
            style="color: var(--color-primary)"
            >English</span
          >
        </p>

        <div class="space-y-3">
          <button
            id="lang-en-btn"
            class="w-full text-center py-3 rounded-lg font-semibold hover:bg-gray-200 transition-colors"
            style="border: 1px solid var(--color-primary)"
          >
            English
          </button>
          <button
            id="lang-hi-btn"
            class="w-full text-center py-3 rounded-lg font-semibold hover:bg-gray-200 transition-colors lang-hi"
            style="border: 1px solid var(--color-primary)"
          >
            हिन्दी (Hindi)
          </button>
          <button
            id="lang-ur-btn"
            class="w-full text-center py-3 rounded-lg font-semibold hover:bg-gray-200 transition-colors lang-ur"
            style="border: 1px solid var(--color-primary); direction: rtl"
          >
            اردو (Urdu)
          </button>
        </div>
      </div>
    </div>

    <!-- Optional Footer Placeholder -->
    <footer class="text-xs text-gray-500 absolute bottom-4 text-center z-10">
      <p data-lang-key="system_name">Madarsa System</p>
    </footer>
  </body>
</html>
